<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.smbms.dao.User.UserMapper">
    <cache/>


    <!-- 查询用户表记录数 -->
    <select id="count" resultType="int">
		select count(1) as count from smbms_provider
	</select>

    <!--	模糊查询 proName like  concat('%',#{proName},'%') 用concat拼接-->
    <select id="getUserListByUsername" resultType="User">
		select * from smbms.smbms_provider where proName like  concat('%',#{proName},'%')
	</select>

    <select id="getUserListByUser" resultType="User">
		select * from smbms.smbms_provider where proName like  concat('%',#{proName},'%') and id=#{id}
	</select>

    <select id="getUserListByMap" resultType="User">
		select * from smbms.smbms_provider where proName like  concat('%',#{proName1},'%') and id=#{id1}
	</select>


    <resultMap id="userResultMap" type="User">
        <result property="id" column="id"/>
        <result property="userCode" column="userCode"/>
        <result property="userName" column="userName"/>
        <result property="gender" column="gender"/>
        <result property="phone" column="phone"/>
        <result property="userRoleName" column="roleName"/>

    </resultMap>
    <!--	方式一-->
    <!--    <select id="getuserlist" resultType="User">-->
    <!--	select u.*,r.roleName userRoleName  from smbms_user u,smbms_role r
    where userName like  concat('%',#{userName},'%') and userRole=#{userRole} and u.userRole=r.id-->

    <!--	方式二-->
    <select id="getuserlist" resultMap="userResultMap">
		select u.*,r.roleName from smbms_user u,smbms_role r
		where userName like  concat('%',#{userName},'%') and userRole=#{userRole} and u.userRole=r.id

	</select>

    <update id="updatePassword">
        	update smbms_user set userPassword=#{word}
		where id=#{id}

    </update>

<!--    choose 当前面有个条件满足了,则后面的就不会再比较了,直接输出内容-->
    <select id="getUserList_choose" resultType="User">
select * from smbms_user where 1=1
        <choose>
            <when test="userName !=null">
                and userName=#{userName}
            </when>
            <when test="userCode !=null">
              and  userCode=#{userCode}
            </when>
            <when test="userRole !=null">
              and  userRole=#{userCode}
            </when>
           <otherwise>
               and year (createDate)=year (#{createDate})
           </otherwise>

        </choose>

    </select>
</mapper>