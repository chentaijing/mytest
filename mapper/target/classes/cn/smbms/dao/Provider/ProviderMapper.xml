<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--命名空间-->
<mapper namespace="cn.smbms.dao.Provider.ProviderMapper">
<!--方式一-->
<!--    <resultMap id="userResultMap" type="Provider">-->
<!--        <id property="id" column="id"/>-->
<!--        <result property="proName" column="proName"/>-->

<!--        <collection property="listbill" ofType="bill">-->
<!--            <result property="productName" column="productName"/>-->
<!--            <result property="productUnit" column="productUnit"/>-->
<!--        </collection>-->
<!--    </resultMap>-->
<!--方式二-->
	<resultMap id="userResultMap" type="Provider">
		<id property="id" column="id"/>
		<result property="proName" column="proName"/>

		<collection property="listbill" ofType="bill" resultMap="aaa">

		</collection>
	</resultMap>

	<resultMap id="aaa" type="bill">
	<result property="productName" column="productName"/>
	<result property="productUnit" column="productUnit"/>
	</resultMap>

    <!-- 查询用户表记录数 -->
    <select id="count1" resultType="int">
		select count(1) from smbms_provider
	</select>
    <!--// cn.User 获取对象返回类型-->
    <!--    <select id="getuserlist" resultType="cn.User">-->
    <select id="getuserlist" resultType="Provider">
		select * from smbms_provider
	</select>

    <!--	//添加语句 -->
    <insert id="addProvider" parameterType="Provider">
		insert into smbms_provider(proCode,proName,createdBy,creationDate)
		values (#{proCode},#{proName},#{createdBy},#{creationDate})
	</insert>
    <!--//修改语句-->
<!--	<set>会自动把后面多余的逗号(,)去掉 就像<where>会把多余的and去掉-->
    <update id="updateProvider" parameterType="Provider">
		update smbms_provider
-- 		if+set组合

		<!--		<set>-->
<!--		<if test="proCode !=null and proCode !=''">-->
<!--			proCode=#{proCode},-->
<!--		</if>-->
<!--			<if test="proName !=null and proName !=''">-->
<!--				proName=#{proName},-->
<!--			</if>-->
<!--			<if test="createdBy !=null and createdBy !='' ">-->
<!--				createdBy=#{createdBy},-->
<!--			</if>-->
<!--			<if test="creationDate !=null  ">-->
<!--				creationDate=#{creationDate}-->
<!--			</if>-->
<!--	</set>-->
<!--		where id=#{id}-->

-- 		if+trim替代if+set
-- 		prefix表示添加前缀, prefixOverrides表示会删除多余的后缀
		<trim prefix="set" prefixOverrides=",">

				<if test="proCode !=null and proCode !=''">
					proCode=#{proCode},
				</if>
				<if test="proName !=null and proName !=''">
					proName=#{proName},
				</if>
				<if test="createdBy !=null and createdBy !='' ">
					createdBy=#{createdBy},
				</if>
				<if test="creationDate !=null  ">
					creationDate=#{creationDate}
				</if>

			where id=#{id}

		</trim>
	</update>

    <delete id="deletebyId">
		delete from smbms_Provider where id=#{id}
	</delete>

	<select id="getProviderandbill" resultMap="userResultMap">
		select * from smbms_Provider p,smbms_Bill b where p.id=#{id} and b.providerId=p.id
	</select>

	<select id="getProviderandbillarray" resultMap="userResultMap">
		select * from smbms_Provider p,smbms_Bill b where p.id in
		<foreach collection="array" item="id" open="(" close= ")"  separator=",">
		#{id}
		</foreach>
		and b.providerId=p.id
	</select>

<!--	collection的值其实是mqp的key值 (底层代码) -->
<!--	如果用map传参的话,collection的值得与map的键值相同,不然会报错映射不到-->
<!--	不用map时,方法里传来的参数是数组的话,collection值是array,参数是List的话,collection值是list-->
	<select id="getProviderandbillList" resultMap="userResultMap">
		select * from smbms_Provider p,smbms_Bill b where p.id in
		<foreach collection="list" item="id" open="(" close= ")"  separator=",">
			#{id}
		</foreach>
		and b.providerId=p.id
	</select>

	<select id="getProviderandbillListMap" resultMap="userResultMap">
		select * from smbms_Provider p,smbms_Bill b where b.productUnit=#{productUnit} and p.id in
		<foreach collection="arrayList" item="id" open="("  close= ")"  separator=",">
			#{id}
		</foreach>
		and b.providerId=p.id
	</select>
</mapper>